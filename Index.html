<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIBINTEK FINAL - DESKTOP</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --brand: #ff9f0a;
            --brand-glow: linear-gradient(90deg, #ff9f0a, #ffca28, #ff9f0a);
            --brand-glow-anim: linear-gradient(-45deg, #ff9f0a, #ffca28, #ffa726, #ff9f0a);
            --bg: #000000;
            --card-bg: #1c1c1e;
            --danger: #ff453a;
            --success: #32d74b;
            --warning: #ffd60a;
            --sidebar-width: 300px;
        }

        @keyframes shimmer {
            0% { background-position: -500px 0; }
            100% { background-position: 500px 0; }
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            overflow-x: hidden;
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            background: var(--bg);
            color: white;
            font-family: -apple-system, system-ui, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Ð¨Ð°Ð¿ÐºÐ° */
        header {
            background: var(--bg);
            padding: 20px 40px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .logo {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: 6px;
            background: var(--brand-glow-anim);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 2s infinite linear;
            text-transform: uppercase;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* ÐÐ¾ÐºÐ¾Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»Ñ */
        .sidebar {
            width: var(--sidebar-width);
            background: #111;
            border-right: 1px solid #333;
            padding: 20px;
            overflow-y: auto;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-item {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid #2c2c2e;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,159,10,0.2);
        }

        .stat-item b { 
            display: block; 
            font-size: 28px; 
            background: var(--brand-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .stat-item span { 
            font-size: 12px; 
            color: #888; 
            text-transform: uppercase;
            margin-top: 5px;
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--brand);
            color: black;
        }
        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }

        /* ÐÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð¾Ð±Ð»Ð°ÑÑÑ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .top-bar {
            padding: 20px 40px;
            border-bottom: 1px solid #333;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            max-width: 500px;
            background: #2c2c2e;
            border: 1px solid #3a3a3c;
            border-radius: 12px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            background: #2c2c2e;
            border-radius: 25px;
            font-size: 13px;
            font-weight: 700;
            color: #888;
            border: 2px solid transparent;
            cursor: pointer;
            white-space: nowrap;
            background: var(--brand-glow);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 2s infinite linear;
            transition: all 0.3s ease;
        }
        .tab.active, .tab:hover {
            background: var(--brand);
            color: black;
            -webkit-text-fill-color: black;
            animation: none;
            border-color: var(--brand);
        }

        .content-area {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 40px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 25px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            border-left: 5px solid var(--success);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
        }
        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(255, 159, 10, 0.3);
        }
        .card.urgent { border-left-color: var(--danger); }
        .card.soon { border-left-color: var(--warning); }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .card-title { 
            font-weight: 900; 
            font-size: 20px; 
            max-width: 70%;
            background: var(--brand-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .card-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 14px;
            min-width: 60px;
            text-align: center;
        }

        .card-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }
        .info-label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .info-value {
            font-size: 16px;
            font-weight: 600;
            word-break: break-word;
        }

        .card-actions {
            display: flex;
            gap: 12px;
        }

        /* ÐÑÐ°Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»Ñ Ñ Ð³ÑÐ°ÑÐ¸ÐºÐ°Ð¼Ð¸ */
        .charts-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .chart-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid #333;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 800;
            margin-bottom: 20px;
            background: var(--brand-glow);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
        }

        /* ÐÐ¾Ð´Ð°Ð»ÑÐ½ÑÐµ Ð¾ÐºÐ½Ð° */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 30px 100px rgba(0,0,0,0.8);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 14px;
            color: #ccc;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            background: #2c2c2e;
            border: 2px solid #3a3a3c;
            border-radius: 12px;
            color: white;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        .form-control:focus {
            outline: none;
            border-color: var(--brand);
            box-shadow: 0 0 0 3px rgba(255,159,10,0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        @media (max-width: 1200px) {
            .content-area {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .content-area {
                padding: 20px;
            }
            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

<header>
    <div class="logo">Ð¡Ð¸Ð±Ð¸Ð½ÑÐµÐº</div>
    <div class="header-actions">
        <button class="btn btn-primary" onclick="showAddModal()">
            â ÐÐ¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°ÑÐ°
        </button>
        <label class="btn btn-primary">
            ð ÐÐ¼Ð¿Ð¾ÑÑ CSV <input type="file" id="file" style="display:none" accept=".csv">
        </label>
        <button class="btn btn-danger" onclick="resetDB()">ðï¸ Ð¡Ð±ÑÐ¾Ñ ÐÐ</button>
        <button class="btn btn-success" onclick="exportCSV()">ð¤ Ð­ÐºÑÐ¿Ð¾ÑÑ CSV</button>
    </div>
</header>

<div style="display: flex; flex: 1;">
    <!-- ÐÐ¾ÐºÐ¾Ð²Ð°Ñ Ð¿Ð°Ð½ÐµÐ»Ñ -->
    <div class="sidebar">
        <div class="stats-grid">
            <div class="stat-item" onclick="setTab('active')">
                <b id="countTotal">0</b>
                <span>Ð ÑÐ°Ð±Ð¾ÑÐµ</span>
            </div>
            <div class="stat-item" onclick="setTab('urgent')" style="border-left: 4px solid var(--danger)">
                <b id="countExp">0</b>
                <span>ÐÑÐ¾ÑÑÐ¾ÑÐµÐ½Ð¾</span>
            </div>
            <div class="stat-item" onclick="setTab('soon')" style="border-left: 4px solid var(--warning)">
                <b id="countSoon">0</b>
                <span>ÐÐ»Ð¸Ð¶Ð°Ð¹ÑÐ¸Ðµ (30Ð´)</span>
            </div>
            <div class="stat-item" onclick="setTab('archive')" style="border-left: 4px solid var(--success)">
                <b id="countDone">0</b>
                <span>ÐÑÑÐ¸Ð²</span>
            </div>
        </div>

        <div class="quick-actions">
            <button class="btn btn-primary" onclick="setTab('active')">ð ÐÐ±Ð½Ð¾Ð²Ð¸ÑÑ</button>
            <button class="btn btn-success" onclick="exportCSV()">ð¾ Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ Ð¾ÑÑÑÑ</button>
            <button class="btn btn-danger" onclick="resetDB()">ðï¸ ÐÑÐ¸ÑÑÐ¸ÑÑ Ð²ÑÑ</button>
        </div>
    </div>

    <!-- ÐÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð½ÑÐµÐ½Ñ -->
    <div class="main-content">
        <div class="top-bar">
            <input type="text" id="search" class="search-box" placeholder="ð ÐÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ, S/N, Ð¼ÐµÑÑÑ...">
            <div class="nav-tabs" id="tabBar">
                <div class="tab active" data-tab="active">Ð Ð ÐÐÐÐ¢Ð</div>
                <div class="tab" data-tab="urgent">ÐÐ ÐÐ¡Ð ÐÐ§ÐÐÐ</div>
                <div class="tab" data-tab="soon">ÐÐÐÐÐÐÐ¨ÐÐ 30 ÐÐ</div>
                <div class="tab" data-tab="archive">ÐÐ Ð¥ÐÐ</div>
                <div class="tab" data-tab="all">ÐÐ¡Ð</div>
            </div>
        </div>

        <div class="content-area">
            <div class="cards-grid" id="listView"></div>
            
            <div class="charts-panel">
                <div class="chart-container">
                    <div class="chart-title">ð Ð¡ÑÐ°ÑÑÑ Ð·Ð°Ð´Ð°Ñ</div>
                    <canvas id="statusChart" height="200"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">ð ÐÐ½ÐµÐ¹ Ð´Ð¾ Ð´ÐµÐ´Ð»Ð°Ð¹Ð½Ð°</div>
                    <canvas id="daysChart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ÐÐ¾Ð´Ð°Ð»ÑÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ/ÑÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°Ð½Ð¸Ñ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle" style="color:var(--brand); margin:0 0 30px 0; font-size:28px;">ÐÐ¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°ÑÐ°</h2>
        <div class="form-group">
            <label>ID</label>
            <input type="text" id="editId" class="form-control" readonly>
        </div>
        <div class="form-group">
            <label>ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ</label>
            <input type="text" id="editName" class="form-control" required>
        </div>
        <div class="form-group">
            <label>ÐÐµÑÑÐ¾ ÑÑÑÐ°Ð½Ð¾Ð²ÐºÐ¸</label>
            <input type="text" id="editPlace" class="form-control">
        </div>
        <div class="form-group">
            <label>S/N</label>
            <input type="text" id="editSn" class="form-control">
        </div>
        <div class="form-group">
            <label>ÐÐ°ÑÐ° (ÐÐ.ÐÐ.ÐÐ)</label>
            <input type="date" id="editDate" class="form-control">
        </div>
        <div class="form-group">
            <label>ÐÑÐ¸Ð¾ÑÐ¸ÑÐµÑ</label>
            <select id="editPriority" class="form-control">
                <option value="normal">ÐÐ¾ÑÐ¼Ð°Ð»ÑÐ½ÑÐ¹</option>
                <option value="high">ÐÑÑÐ¾ÐºÐ¸Ð¹</option>
                <option value="critical">ÐÑÐ¸ÑÐ¸ÑÐµÑÐºÐ¸Ð¹</option>
            </select>
        </div>
        <div class="modal-buttons">
            <button class="btn btn-cancel" onclick="closeEdit()">â ÐÑÐ¼ÐµÐ½Ð°</button>
            <button class="btn btn-success" onclick="saveEdit()">ð¾ Ð¡Ð¾ÑÑÐ°Ð½Ð¸ÑÑ</button>
        </div>
    </div>
</div>

<script>
    let db = JSON.parse(localStorage.getItem('sib_v4')) || [];
    let filter = 'active';
    let editingIndex = -1;
    let statusChart, daysChart;

    // ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ ÑÐ°ÑÑÐ¾Ð²
    function initCharts() {
        const ctx1 = document.getElementById('statusChart').getContext('2d');
        statusChart = new Chart(ctx1, {
            type: 'doughnut',
            data: { labels: [], datasets: [{ data: [], backgroundColor: ['#32d74b', '#ff453a', '#ffd60a', '#666'] }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
        });

        const ctx2 = document.getElementById('daysChart').getContext('2d');
        daysChart = new Chart(ctx2, {
            type: 'bar',
            data: { labels: [], datasets: [{ data: [], backgroundColor: '#ff9f0a' }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });
    }

    document.getElementById('file').onchange = (e) => {
        const file = e.target.files[0];
        if(!file) return;
        Papa.parse(file, {
            complete: (res) => {
                db = res.data.slice(1).map(r => ({
                    id: r[0], place: r[4], name: r[5], sn: r[7], 
                    dateStr: r[11], ts: parseDate(r[11]), done: false, priority: 'normal'
                })).filter(x => x.dateStr);
                db.sort((a,b) => a.ts - b.ts);
                save(); render();
            }
        });
    };

    function parseDate(s) {
        if(!s) return 0;
        const p = s.split('.');
        return new Date(p[2].length===2?"20"+p[2]:p[2], p[1]-1, p[0]).getTime();
    }

    function formatDateForInput(ts) {
        const d = new Date(ts);
        return d.toISOString().split('T')[0];
    }

    function formatDateDisplay(ts) {
        const d = new Date(ts);
        return `${d.getDate().toString().padStart(2,'0')}.${(d.getMonth()+1).toString().padStart(2,'0')}.${d.getFullYear().toString().slice(-2)}`;
    }

    function save() { localStorage.setItem('sib_v4', JSON.stringify(db)); }

    function setTab(t) {
        filter = t;
        document.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
        document.querySelector(`[data-tab="${t}"]`).classList.add('active');
        document.querySelectorAll('.stat-item').forEach((item, i) => {
            item.style.borderLeftColor = i === 0 ? 'var(--success)' : i === 1 ? 'var(--danger)' : i === 2 ? 'var(--warning)' : 'var(--success)';
        });
        render();
    }

    function showAddModal() {
        editingIndex = -1;
        document.getElementById('modalTitle').textContent = 'ÐÐ¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°ÑÐ°';
        document.getElementById('editId').value = (Math.max(...db.map(x => parseInt(x.id)), 0) + 1).toString();
        document.getElementById('editName').value = '';
        document.getElementById('editPlace').value = '';
        document.getElementById('editSn').value = '';
        document.getElementById('editDate').value = '';
        document.getElementById('editPriority').value = 'normal';
        document.getElementById('editModal').style.display = 'flex';
    }

    function editItem(idx) {
        editingIndex = idx;
        const item = db[idx];
        document.getElementById('modalTitle').textContent = 'Ð ÐµÐ´Ð°ÐºÑÐ¸ÑÐ¾Ð²Ð°ÑÑ Ð·Ð°Ð´Ð°ÑÑ';
        document.getElementById('editId').value = item.id;
        document.getElementById('editName').value = item.name;
        document.getElementById('editPlace').value = item.place;
        document.getElementById('editSn').value = item.sn;
        document.getElementById('editDate').value = formatDateForInput(item.ts);
        document.getElementById('editPriority').value = item.priority || 'normal';
        document.getElementById('editModal').style.display = 'flex';
    }

    function saveEdit() {
        const name = document.getElementById('editName').value.trim();
        if(!name) return alert('ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ð±ÑÐ·Ð°ÑÐµÐ»ÑÐ½Ð¾!');
        
        if(editingIndex === -1) {
            db.unshift({
                id: document.getElementById('editId').value,
                name, place: document.getElementById('editPlace').value,
                sn: document.getElementById('editSn').value,
                dateStr: '', ts: 0, done: false,
                priority: document.getElementById('editPriority').value
            });
        } else {
            const item = db[editingIndex];
            item.name = name;
            item.place = document.getElementById('editPlace').value;
            item.sn = document.getElementById('editSn').value;
            item.priority = document.getElementById('editPriority').value;
            const dateInput = document.getElementById('editDate').value;
            if(dateInput) {
                item.ts = new Date(dateInput).getTime();
                item.dateStr = formatDateDisplay(item.ts);
            }
        }
        save();
        closeEdit();
        render();
    }

    function closeEdit() {
        document.getElementById('editModal').style.display = 'none';
        editingIndex = -1;
    }

    function markDone(i) { 
        db[i].done = true; 
        save(); 
        render(); 
    }

    function deleteItem(i) {
        if(confirm('Ð£Ð´Ð°Ð»Ð¸ÑÑ Ð·Ð°Ð´Ð°ÑÑ?')) {
            db.splice(i, 1);
            save();
            render();
        }
    }

    function exportCSV() {
        const headers = ['ID', '', '', '', 'ÐÐµÑÑÐ¾', 'ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ', '', '', 'S/N', '', '', 'ÐÐ°ÑÐ°'];
        const csv = [headers.join(','), ...db.map(item => 
            [item.id, '', '', '', item.place, item.name, '', '', item.sn, '', '', item.dateStr].join(',')
        )].join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `sibintek_export_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
    }

    function render() {
        const view = document.getElementById('listView');
        const query = document.getElementById('search').value.toLowerCase();
        view.innerHTML = '';
        
        const now = new Date().setHours(0,0,0,0);
        let s = { total:0, exp:0, soon:0, done:0, all:0 };
        let daysData = {};

        db.forEach((item, idx) => {
            const diff = Math.ceil((item.ts - now) / 86400000);
            s.all++;
            if(item.done) s.done++; 
            else {
                s.total++;
                if(diff < 0) s.exp++; 
                else if(diff <= 30) s.soon++;
                if(diff > 0 && diff < 100) daysData[diff] = (daysData[diff] || 0) + 1;
            }

            let show = false;
            if(filter === 'all') show = true;
            else if(filter === 'active' && !item.done) show = true;
            else if(filter === 'urgent' && !item.done && diff < 0) show = true;
            else if(filter === 'soon' && !item.done && diff >= 0 && diff <= 30) show = true;
            else if(filter === 'archive' && item.done) show = true;

            if(show && (!query || 
                item.name.toLowerCase().includes(query) || 
                item.sn.toLowerCase().includes(query) || 
                item.place.toLowerCase().includes(query))) {
                
                const state = diff < 0 ? 'urgent' : (diff <= 30 ? 'soon' : '');
                const priorityColor = item.priority === 'high' ? 'var(--warning)' : 
                                    item.priority === 'critical' ? 'var(--danger)' : 'var(--success)';
                
                const card = document.createElement('div');
                card.className = `card ${state}`;
                card.onclick = (e) => { if(!e.target.closest('.card-actions')) editItem(idx); };
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">#${item.id} ${item.name}</div>
                        <div class="card-badge" style="background:var(${priorityColor === 'var(--warning)' ? 'warning' : priorityColor === 'var(--danger)' ? 'danger' : 'success'}); color:white;">
                            ${diff} Ð´Ð½.
                        </div>
                    </div>
                    <div class="card-grid">
                        <div class="info-item">
                            <div class="info-label">ÐÐµÑÑÐ¾ ÑÑÑÐ°Ð½Ð¾Ð²ÐºÐ¸</div>
                            <div class="info-value">${item.place}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">S/N</div>
                            <div class="info-value">${item.sn}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ÐÐ»Ð°Ð½</div>
                            <div class="info-value">${item.dateStr}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">ÐÑÐ¸Ð¾ÑÐ¸ÑÐµÑ</div>
                            <div class="info-value" style="color:${priorityColor}">${item.priority.toUpperCase()}</div>
                        </div>
                    </div>
                    <div class="card-actions">
                        ${!item.done ? `
                            <button class="btn btn-success" onclick="event.stopPropagation(); markDone(${idx})" style="flex:1;">â ÐÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¾</button>
                            <button class="btn btn-primary" onclick="event.stopPropagation(); editItem(${idx})" style="flex:1;">âï¸ Ð ÐµÐ´.</button>
                        ` : ''}
                        <button class="btn btn-danger" onclick="event.stopPropagation(); deleteItem(${idx})" style="flex:1;">ðï¸ Ð£Ð´Ð°Ð»Ð¸ÑÑ</button>
                    </div>
                `;
                view.appendChild(card);
            }
        });

        // ÐÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑÐ°ÑÐ¸ÑÑÐ¸ÐºÐ¸
        document.getElementById('countTotal').innerText = s.total;
        document.getElementById('countExp').innerText = s.exp;
        document.getElementById('countSoon').innerText = s.soon;
        document.getElementById('countDone').innerText = s.done;

        // ÐÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ°ÑÑÐ¾Ð²
        statusChart.data.labels = ['ÐÑÐ¿Ð¾Ð»Ð½ÐµÐ½Ð¾', 'ÐÑÐ¾ÑÑÐ¾ÑÐµÐ½Ð¾', 'Ð¡ÐºÐ¾ÑÐ¾', 'Ð ÑÐ°Ð±Ð¾ÑÐµ'];
        statusChart.data.datasets[0].data = [s.done, s.exp, s.soon, s.total - s.exp - s.soon];
        statusChart.update();

        daysChart.data.labels = Object.keys(daysData).slice(0, 10);
        daysChart.data.datasets[0].data = Object.values(daysData).slice(0, 10);
        daysChart.update();
    }

    // Ð¡Ð¾Ð±ÑÑÐ¸Ñ
    document.querySelectorAll('.tab').forEach(tab => {
        tab.onclick = () => setTab(tab.dataset.tab);
    });
    document.querySelectorAll('.stat-item').forEach((item, i) => {
        item.onclick = () => setTab(['active', 'urgent', 'soon', 'archive'][i]);
    });

    document.getElementById('search').oninput = render;
    document.getElementById('editModal').onclick = (e) => {
        if(e.target.classList.contains('modal')) closeEdit();
    };

    // ÐÐ½Ð¸ÑÐ¸Ð°Ð»Ð¸Ð·Ð°ÑÐ¸Ñ
    initCharts();
    render();
</script>

</body>
</html>
